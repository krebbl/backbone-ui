(function(){var a=jQuery;if(!window.UI){window.UI={}}UI.VERSION="0.1.0";UI.lastID=1;UI.createID=function(){return UI.lastID++};UI.loc=function(b){return UI.Locale.localize(b)}})();(function(){UI.Binding=function(a){this.init(a)};UI.Binding.prototype={event:"change",callbacks:[],transform:function(b,a){return b},init:function(a){_.extend(this,a)},add:function(c,b){var a={fnc:this.createCallbackFnc(c,b),target:b};this.model.bind(this.getEventName(),a.fnc,a.target);this.callbacks.push(a)},createCallbackFnc:function(c,b){var a=this;return function(d,e){c.call(b,a.transform(e,d))}},getEventName:function(){if(this.key!=null){return this.event+":"+this.key}else{return this.event}},remove:function(b){var a=this;_.each(this.callbacks,function(c,d){if(c.fnc==b){a.callbacks.slice(d,1)}});this.model.unbind(this.getEventName(),b)},removeByTarget:function(b){var a=this;var c;_.each(this.callbacks,function(d,e){if(d.target==b){c=d;a.callbacks.slice(e,1)}});this.model.unbind(this.getEventName(),c.fnc)},getValue:function(){if(this.key!=null){if(this.event=="change"){var a=this.model.get(this.key);return this.transform(a,this.model)}}return this.transform(null,this.model)},setValue:function(b,a){if(_.isUndefined(a)){var a=true}var c={};c[this.key]=b;this.model.set(c,{silent:a})},setModel:function(b){var a=this;var c=this.model;this.model=b;_.each(this.callbacks,function(d){c.unbind("change:"+a.key,d.fnc);a.add(d.fnc,d.target);a.model.trigger("change:"+a.key)})},trigger:function(){this.model.trigger("change:"+this.key)}}})();(function(){UI.ErrorFieldRenderer=function(a,b){}})();(function(){UI.Locale=(function(a){var a={};return{init:function(b){a=b},localize:function(b){if(!_.isUndefined(a[b])){return a[b]}return b}}}())})();(function(){var a=jQuery;UI.View=Backbone.View.extend({renderedChildViews:[],bindings:{},defaultOptions:{},childViews:[],initialize:function(){this.options=_.extend({fitLayout:false,selectable:false,selected:false,templateRenderer:function(c,b){return JST[c]({view:b})}},this.defaultOptions,this.options);this.bindModelEvents();this.initCallbacks();this.initBindings()},bindModelEvents:function(){},initCallbacks:function(){var b=this;if(this.options.callbacks){_.each(this.options.callbacks,function(d,c){if(_.isFunction(d)){b.bind(c,d)}})}},initBindings:function(){var b=this;var c=function(e,d){if(_.isFunction(e.add)){e.add(function(f){b.setOption(d,f)},b);b.setOption(d,e.getValue());b.bindings[d]=e}};this.bindings={};_(this.options).each(function(e,f){var g=f.lastIndexOf("Binding");if(g>0){var d=f.substr(0,g);c(e,d)}})},render:function(){this.renderedChildViews=[];this.$el=a(this.el);this.$el.empty();if(_.isUndefined(this.options.container)){throw"No container to render!"}else{this.$container=a(this.options.container)}this.$container.append(this.$el);this.layoutElement();if(this.options.innerHTML){this.renderInnerHTML(this.options.innerHTML)}else{if(this.options.template){this.renderInnerHTML(this.options.templateRenderer(this.options.template,this))}else{if(this.options.childViews){this.renderChildViews(this.options.childViews)}}}this.renderContent();this.renderClassName(this.className);this.renderVisible(this.options.visible);this.renderSelected(this.options.selected);this.renderSelectable(this.options.selectable);var b=this;this.$el.bind("click",function(c){b.trigger("click",c,b)});this.afterRender();this.trigger("afterRender",this)},renderClassName:function(b){this.$el.attr("class",b)},afterRender:function(){},renderTo:function(b){this.options.container=b;this.render()},layoutElement:function(){var b=this;if(this.options.fitLayout===true){this.$el.css({"float":"left",width:"100%",height:"100%",overflow:"hidden"});if(this.$container.context.nodeName=="BODY"){a(window).resize(function(c){})}else{this.$container.resize(function(){})}this.$el.resize(function(c){c.stopPropagation()})}else{if(this.options.height){this.$el.height(this.options.height)}if(this.options.width){this.$el.width(this.options.width)}}},resize:function(){if(this.isVisible()){this.$el.resize()}},resizeContent:function(){},isVisible:function(){return this.$el.is(":visible")},renderVisible:function(c){if(c===true){this.$el.show();this.trigger("afterShow");var b=this;b.resize()}else{if(c===false){this.trigger("beforeHide");this.$el.hide()}}},renderModel:function(b){this.render()},renderContent:function(){},renderChildViews:function(d){this.removeRenderedChildViews();var b;for(var c=0;c<d.length;c++){b=d[c];this.renderChildView(b)}},renderChildView:function(c){if(!c.hasContainer()){c.options.container=this.$el}c.render();c.parent=this;this.renderedChildViews.push(c);var b=this;var d=["beforeHide","afterShow"];_.each(d,function(f){b.bind(f,function(){c.trigger(f)})})},clearChildViews:function(){if(this.options.childViews){while(this.options.childViews.length>0){this.removeChildView(this.options.childViews[0])}}},addChildView:function(b){if(!this.options.childViews){this.options.childViews=[]}this.options.childViews.push(b);if(this.isRendered()){this.renderChildView(b)}},removeChildView:function(b){b.remove()},onChildViewRemoved:function(b){if(this.renderedChildViews){var c=this;var d=-1;_.each(this.renderedChildViews,function(e,f){if(b==e){d=f}});if(d>-1){this.renderedChildViews.splice(d,1)}}if(this.options.childViews){_.each(this.options.childViews,function(e,f){if(b==e){d=f}});if(d>-1){this.options.childViews.splice(d,1)}}},renderInnerHTML:function(b){if(_.isFunction(this.options.htmlRenderer)){b=this.options.htmlRenderer(b)}this.$el.html(b)},renderHeight:function(b){this.$el.height(b)},renderWidth:function(b){this.$el.width(b)},getHeight:function(){return this.$el.height()},getWidth:function(){return this.$el.width()},renderSelectable:function(c){if(c===true){var b=this;this.$el.bind("click.selected",function(){b.set({selected:!b.isSelected()})})}else{if(c===false){this.$el.unbind("click.select");this.set({selected:false})}}},isSelected:function(){return !_.isUndefined(this.options.selected)&&this.options.selected===true},renderSelected:function(b){if(this.options.selectable!==true){return}if(b===true){this.$el.addClass("selected")}else{if(b===false){this.$el.removeClass("selected")}}},hasOption:function(b){return !_.isUndefined(this.options[b])&&this.options[b]!=null},set:function(d,c){if(_.isObject(d)){var b=this;_.each(d,function(f,e){b.setOption(e,f,c)})}},setOption:function(b,e,c){var d;if(b=="className"||b=="model"||b=="collection"){d=this[b];this[b]=e}else{d=this.options[b];this.options[b]=e}this._renderOption(b,e,d);if(!c){this.trigger("change:"+b,this,e)}},_renderOption:function(b,d,c){if(!this.isRendered()){return}b=b[0].toUpperCase()+b.substr(1);var e="render"+b;if(_.isFunction(this[e])){this[e](d,c)}},get:function(b){return this.options[b]},has:function(b){return !_.isUndefined(this.options[b])},remove:function(){var b=this;_.each(this.bindings,function(c){c.removeByTarget(b)});if(this.parent){this.parent.childViewRemoved(this)}if(this.isRendered()){this.$el.remove();delete this.$el}},isRendered:function(){return !_.isUndefined(this.$el)},hasContainer:function(){return !_.isUndefined(this.options.container)},getBinding:function(b){return this.bindings[b]},focus:function(){this.$el.focus()}})})();(function(){UI.ListView=UI.View.extend({defaultOptions:{itemIdKey:"cid",selectable:false,multiSelect:false,needsSelection:false},tagName:"ul",renderedItems:[],itemToView:null,renderContent:function(){var a=this;this.renderedItems=[];if(this.collection){this.renderCollection(this.collection)}else{if(this.options.items){this.renderItems(this.options.items)}}},createListElement:function(b){var c=this.$el.children("li");var a=$(document.createElement("li"));if(c.length==0){a.addClass("first")}c.last().removeClass("last");a.addClass("last");this.$el.append(a);return a},removeItem:function(c){var a=this.getViewByItem(c);if(a!=null){a.remove();var b=this.getIndexOfItem(c);if(b>-1){this.renderedItems.splice(b,1)}this.$el.children().last().addClass("last")}this.options.items.splice(b,1)},getViewByItem:function(b){var a=this.getIndexOfItem(b);if(a>-1){return this.renderedChildViews[a]}else{return null}},renderCollection:function(b,c){var a=this;if(c){c.unbind("add",this.addItem,this);c.unbind("remove",this.removeItem,this);c.unbind("reset",this.renderCollection,this)}b.bind("add",this.addItem,this);b.bind("remove",this.removeItem,this);b.bind("reset",this.renderCollection,this);this.set({items:b.models})},renderItems:function(c){this.clearRenderedItems();var b=this;var a;_.each(c,function(e,d){b.renderItem(e,d)})},addItem:function(a){if(!this.options.items){this.options.items=[]}this.options.items.push(a);if(this.isRendered()){this.renderItem(a,this.options.items,this.options.items.length-1)}},renderItem:function(d,c){if(!_.isFunction(this.options.itemToView)){throw"No item to view function defined"}var b=this.options.itemToView(d);b.options.container=this.createListElement();this.addChildView(b);this.renderedItems.push(d);if(this.options.needsSelection===true&&this.renderedItems.length===this.options.items.length){if(this.getSelectedViews().length==0&&this.renderedChildViews.length>0){var a=this.renderedChildViews[0];a.set({selected:true})}}},renderChildView:function(a){a.bind("change:selected",this.checkSelection,this);UI.View.prototype.renderChildView.call(this,a)},clearRenderedItems:function(){while(this.renderedItems.length>0){this.removeRenderedItem(this.renderedItems[0])}},getSize:function(){return _.size(this.renderedItems)},selectItem:function(b){var a=this.getViewByItem(b);a.set({selected:true})},checkSelection:function(a){if(a.isSelected()){var b=this;_.each(this.renderedChildViews,function(c,d){if(c!=a&&b.options.multiSelect===false&&c.isSelected()){c.set({selected:false})}});this.set({selectedItems:this.getSelectedItems(),selectedViews:this.getSelectedViews()})}else{if(this.getSelectedViews().length==0){a.set({selected:true})}}},getSelectedItems:function(){var b=[];var a=this;_.each(this.renderedItems,function(d,c){if(a.renderedChildViews[c].isSelected()){b.push(d)}});return b},getSelectedViews:function(){var a=[];_.each(this.renderedChildViews,function(b,c){if(b.isSelected()){a.push(b)}});return a},getIndexOfView:function(a){var b=-1;_.each(this.childViews,function(c,d){if(c==a){b=d}});return b},getIndexOfItem:function(b){var a=-1;_.each(this.renderedItems,function(d,c){if(d==b){a=c;return}});return a}});_.extend(UI.ListView.prototype,UI.LoadingMask)})();(function(){UI.ContainerView=UI.ListView.extend({tagName:"div",createListElement:function(a){return this.$el}})})();(function(){UI.FieldView=UI.View.extend({tagName:"div",renderContent:function(){},bindModelEvents:function(){if(this.model&&this.options.field){var a=this;this.model.bind("change:"+this.options.field,this.onModelValueChange,a);this.model.bind("error",this.onModelError,a)}},renderContent:function(){this.options=_.extend({},{enable:true,silentChange:false,unsetOnDisable:false,errorRenderer:UI.FieldErrorRenderer,fieldTemplate:"field"},this.options);this.$el.html(JST[this.options.fieldTemplate]({view:this}));if(_.isUndefined(this.options.fieldId)){this.options.fieldId="field-"+UI.createID()}if(_.isUndefined(this.options.name)){this.options.name=this.options.fieldId}this.fieldID=this;this.$el.find("label").first().attr("for",this.options.fieldId);this.renderLabel(this.options.label);this.$inputWrapper=this.$el.find("div.input").first();if(this.options.inputTemplate){this.$inputWrapper.html(JST[this.options.inputTemplate]({view:this}))}this.renderInputElement();this.bindInputEvents();var a=this.options.value;if(this.model&&this.options.field){a=this.model.get(this.options.field)}this.renderValue(a);if(this.options.errors){this.renderError(this.options.error)}this.renderEnable(this.options.enable)},onInputValueChange:function(){var b=this.bindings.value;var c=this.getValueForModel();if(b){b.setValue(c,this.options.silentChange)}else{if(this.model&&this.options.field){if(c!=null){var a={};a[this.options.field]=c;this.model.set(a,{silent:this.options.silentChange})}else{if(this.options.unsetOnDisable===true){this.model.unset(this.options.field)}}}}this.options.value=c;this.trigger("valueChanged",this,c)},onModelValueChange:function(){this.set({value:this.model.get(this.options.field)})},renderValue:function(a){this.renderInputValue(a)},renderError:function(a){if(_.isUndefined(a)||a==null){this.$el.removeClass("has-error");this.$el.find(".error").first().html("")}else{this.$el.addClass("has-error");if(_.isArray(a)){a=a[0]}this.options.errorRenderer(this,a)}},onModelError:function(c,b){if(!_.isUndefined(b)){var a=b[this.options.field];this.set({error:a})}},renderLabel:function(a){if(_.isUndefined(a)){a=""}this.$el.find("label").first().html(a)},renderEnable:function(a){if(!_.isFunction(this.getInputElement)){return}if(a===false){this.$el.addClass("disabled");this.getInputElement().attr("disabled","disabled");this.onInputValueChange();this.trigger("disable",this)}else{if(a===true){this.$el.removeClass("disabled");this.getInputElement().removeAttr("disabled");this.onInputValueChange();this.trigger("enable",this)}}},getValueForModel:function(){},renderInputElement:function(){},bindInputEvents:function(){},renderInputValue:function(a){}});UI.FieldErrorRenderer=function(a,b){a.$el.find(".error").html(b)}})();(function(){UI.LinkView=UI.ButtonView.extend({tagName:"a",defaultOptions:{fitLayout:false,label:null},renderContent:function(){this.renderHref(this.options.href);this.renderLinkTarget(this.options.linkTarget);if(this.options.label){this.renderLabel(this.options.label)}this.set({menuView:this.options.menuView})},renderLabel:function(a){if(this.renderedLabelView){this.renderedLabelView.remove()}this.renderedLabelView=new UI.View({tagName:"span",innerHTML:a});this.renderChildView(this.renderedLabelView)},renderHref:function(a){if(_.isUndefined(a)){a="#";this.$el.attr("onclick","return false;")}else{this.$el.removeAttr("onclick")}this.$el.attr("href",a)},renderLinkTarget:function(a){if(!this.has("href")){this.$el.removeAttr("target");this.options.linkTarget="";return}if(_.isUndefined(a)){this.$el.removeAttr("target")}else{this.$el.attr("target",a)}},renderMenuView:function(a,c){var b=this;if(c){}if(a){var b=this;a.set({container:this.$el.parent()});this.addChildView(a);this.$el.parent().addClass("dropdown");this.$el.bind("click.dropdown",function(f){if(f){f.stopPropagation();f.preventDefault()}var d=b.$el.parent();d.toggleClass("open")});$(document.body).bind("click.dropdown"+this.cid,function(d){b.$el.parent().removeClass("open")})}else{this.$el.parent().removeClass("dropdown");this.$el.unbind("click.dropdown");$(document.body).unbind("click.dropdown"+this.cid)}}})})();(function(){UI.ButtonView=UI.View.extend({tagName:"button",defaultOptions:{fitLayout:false,label:null,selectable:true,enabled:true},renderContent:function(){this.renderEnabled(this.options.enabled)},renderIconClass:function(a){if(this.renderedIconView){this.renderedIconView.remove()}this.renderedIconView=new UI.View({className:"icon "+a,tagName:"span"});this.renderChildView(this.renderedIconView)},renderEnabled:function(a){if(a===true){this.$el.removeAttr("disabled")}else{if(a===false){this.$el.attr("disabled","disabled")}}}})})();(function(){UI.SegmentedView=UI.View.extend({defaultOptions:{fitLayout:true},renderContent:function(){},renderVisibleView:function(a){_.each(this.renderedChildViews,function(b){if(b!=a&&b.isVisible()){b.set({visible:false})}});if(!_.include(this.renderedChildViews,a)){this.renderChildView(a)}else{if(this.currentView!=a){a.set({visible:true})}}this.currentView=a},getCurrentView:function(){return this.currentView},removeRenderedChildView:function(a){UI.View.prototype.removeRenderedChildView.call(this,a);if(this.currentView==a){this.set({visibleView:this.renderedChildViews[this.renderedChildViews.length-1]})}}})})();(function(){UI.TabView=UI.View.extend({defaultOptions:{linkListView:new UI.ListView({className:"tabs",itemToView:function(a){var b="";if(a.has("title")){b=a.get("title")}return new UI.LinkView({selectable:true,label:b})}}),segmentedView:new UI.SegmentedView({fitLayout:false,className:"tab-content"}),emptyView:new UI.View({}),tabViews:[]},renderContent:function(){this.options.linkListView.set({multiSelect:false,needsSelection:true});var a=this;this.options.linkListView.bind("change:selectedItems",function(b,c){a.options.segmentedView.set({visibleView:c[0]})});this.renderChildView(this.options.linkListView);this.renderChildView(this.options.segmentedView);this.renderTabViews(this.options.tabViews)},renderTabViews:function(a){var b=this;this.options.linkListView.clearChildViews();this.options.segmentedView.clearChildViews();_.each(a,function(c){b.renderTabView(c)})},addTabView:function(a){this.options.tabViews.push(a);if(this.isRendered()){this.renderTabView(a)}},renderTabView:function(a){this.options.linkListView.addItem(a)},removeTabView:function(a){this.options.linkListView.removeItem(a);this.options.segmentedView.removeChildView(a)}})})();(function(){UI.CheckboxFieldView=UI.FieldView.extend({optionSelector:"input:checkbox",selectionAttribute:"checked",defaultOptions:{multiSelect:true,optionTemplate:"fields/checkbox_input",valueKey:"value",labelKey:"label"},getValueForModel:function(){var b={};var d;var e=this.getOptionElements();var c=e.size();var a=this;d=[];e.each(function(g){if($(this).attr(a.selectionAttribute)){var f=a.options.items[g][a.options.valueKey];if(a.options.multiSelect){d.push(f)}else{d=f}}else{if(c==1){d=(f==a.options.items[g][a.options.valueKey])}}});return d},renderInputElement:function(){this.renderItems(this.options.items)},bindInputEvents:function(){var a=this;this.getInputElement().bind("change",function(){a.onInputValueChange()})},renderInputValue:function(b){var a=this;this.getOptionElements().each(function(d){var f=$(this);var c=false;var e=a.options.items[d][a.options.valueKey];if(a.options.multiSelect===true&&_.isArray(b)){c=_.contains(b,e)}else{c=(e==b)}if(c===true){f.attr(a.selectionAttribute,a.selectionAttribute)}else{if(f.attr(a.selectionAttribute)){f.removeAttr(a.selectionAttribute)}}})},renderItems:function(b){if(this.isRendered()){this.getOptionElements().remove();var a=this;_.each(this.options.items,function(d){a.renderItem(d)});var c=this.getInputElement();c.attr("name",this.options.name);this.$input=c}this.options.items=b},renderItem:function(a){this.$inputWrapper.append(JST[this.options.optionTemplate]({label:a[this.options.labelKey],value:a[this.options.valueKey],item:a}))},getInputElement:function(){return this.$inputWrapper.find(this.optionSelector)},getOptionElements:function(){return this.$inputWrapper.find(this.optionSelector)}})})();(function(){UI.DateFieldView=UI.FieldView.extend({defaultOptions:{inputTemplate:"fields/date_input",dateFormat:"yyyy-MM-dd"},renderInputElement:function(){this.$day=this.$el.find("select.day").first();this.$month=this.$el.find("select.month").first();this.$year=this.$el.find("input.year").first();this.renderMonthSelection();this.$day.attr({id:this.options.fieldId})},bindInputEvents:function(){var a=this;this.$day.bind("change",function(){a.onInputValueChange()});this.$month.bind("change",function(){a.onInputMonthChange()});this.$year.bind("change",function(){a.onInputYearChange()})},onInputYearChange:function(){var a=parseInt(this.$year.val());this.onInputMonthChange()},onInputMonthChange:function(){var a=parseInt(this.$day.val());var c=parseInt(this.$month.val());var b=parseInt(this.$year.val());var d=Date.getDaysInMonth(b,c);this.renderDaySelection(d);if(a>d){this.$day.val(d)}else{this.$day.val(a)}this.onInputValueChange()},renderDaySelection:function(c){if(this.$day.children().length==c){return}this.$day.empty();var a="";for(var b=1;b<=c;b++){a=(b<10)?"0"+b:b;this.$day.append("<option value='"+b+"'>"+a+"</option>")}},renderMonthSelection:function(){this.$month.empty();var a=Date.CultureInfo.monthNames;var b="";for(var c=0;c<12;c++){this.$month.append("<option value='"+c+"'>"+a[c]+"</option>")}},renderInputValue:function(b){var a=Date.parseExact(b,this.options.dateFormat);if(!a){throw"Couldn't parse Date. Please specify format!"}this.renderDaySelection(Date.getDaysInMonth(a.getFullYear(),a.getMonth()));this.$month.val(a.getMonth());this.$day.val(a.getDate());this.$year.val(a.getFullYear())},getValueForModel:function(){var b={};var h=parseInt(this.$year.val()),a=parseInt(this.$month.val()),g=parseInt(this.$day.val());try{Date.validateDay(g,h,a)}catch(f){return null}var c=new Date(h,a,g);if(c.toString()=="Invalid Date"){return null}return c.toString(this.options.dateFormat)},getInputElement:function(){return this.$inputWrapper.find("select,input")}})})();(function(){UI.RadioboxFieldView=UI.CheckboxFieldView.extend({optionSelector:"input:radio",defaultOptions:{multiSelect:false,optionTemplate:"fields/radiobox_input",valueKey:"value",labelKey:"label"}})})();(function(){UI.SelectFieldView=UI.CheckboxFieldView.extend({optionSelector:"option",selectionAttribute:"selected",defaultOptions:{inputTemplate:"fields/select_input",multiSelect:false,valueKey:"value",labelKey:"label"},renderInputElement:function(){this.$select=this.$el.find("select").first();this.$select.attr({id:this.options.fieldId,name:this.options.name});if(this.options.multiSelect===true){this.$select.attr("multiple","multiple")}this.renderItems(this.options.items)},renderItem:function(a){this.$select.append("<option value='"+a[this.options.valueKey]+"'>"+UI.loc(a[this.options.labelKey])+"</option>")},bindInputEvents:function(){var a=this;this.$select.bind("change",function(){a.onInputValueChange()})},getInputElement:function(){return this.$select},getOptionElements:function(){return this.$select.find("option")}})})();(function(){UI.TextFieldView=UI.FieldView.extend({defaultOptions:{inputTemplate:"fields/text_input",type:"text",placeholder:""},getValueForModel:function(){if(this.$input.attr("disabled")){return null}return this.$input.val()},renderInputElement:function(){this.$input=this.$el.find("input").first();this.$input.attr({id:this.options.fieldId,name:this.options.name,placeholder:this.options.placeholder})},bindInputEvents:function(){var a=this;this.$input.bind("change",function(){a.onInputValueChange()})},renderInputValue:function(a){this.$el.find("input").first().val(a)},getType:function(){return this.options.type},getInputElement:function(){return this.$input}})})();(function(){UI.TextareaFieldView=UI.FieldView.extend({defaultOptions:{inputTemplate:"fields/textarea_input",rows:3},getValueForModel:function(){if(this.$textarea.attr("disabled")){return null}return this.$textarea.html()},renderInputElement:function(){this.$textarea=this.$el.find("textarea").first();this.$textarea.attr({id:this.options.fieldId,name:this.options.name})},bindInputEvents:function(){var a=this;this.$textarea.bind("change",function(){a.onInputValueChange()})},renderInputValue:function(a){this.$textarea.html(a)},getType:function(){return this.options.type},getInputElement:function(){return this.$textarea},getRows:function(){return this.options.rows}})})();